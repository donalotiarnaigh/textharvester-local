<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Processing - Historic Graves Text Harvester</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>

    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
      }
      .content-wrap {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: calc(
          100vh - 100px
        ); /* Adjusted to ensure content fits without overflow, considering navbar and footer */
        padding: 0 15px; /* Add padding to ensure content does not touch the edges on small screens */
      }
      .footer {
        background-color: #f8f9fa;
        color: black;
        text-align: center;
        padding: 20px 0; /* Slightly reduced for smaller screens */
        font-size: 0.85em; /* Adjusted for better readability on small devices */
        width: 100%;
        position: absolute;
        bottom: 0; /* Ensure footer sticks to the bottom */
      }
      .loading-container,
      .processing-message {
        text-align: center;
        padding: 0 10px; /* Padding to prevent text from touching the screen edges */
      }
      .loading {
        display: inline-block;
        width: 30px;
        height: 30px;
        border: 3px solid rgba(195, 195, 195, 0.6);
        border-radius: 50%;
        border-top-color: #636767;
        animation: spin 1s ease-in-out infinite;
      }
      .progress-container {
        display: flex; /* Use flexbox for the container */
        justify-content: center; /* Center the progress bar horizontally */
        width: 80%; /* Adjust this percentage to your preference */
        max-width: 1200px; /* Maximum width can be set to a fixed pixel value */
        margin: auto; /* Auto margins for centering */
      }

      .progress {
        flex: 1; /* Flex property to take available space */
        background-color: #eee;
        margin-top: 20px; /* Spacing above the progress bar */
        height: 20px; /* Set a fixed height for the progress bar */
        border-radius: 5px; /* Optional rounded corners */
      }

      .progress-bar {
        display: flex; /* Make the progress bar a flex container */
        align-items: center; /* Vertically center the flex items (the text) */
        justify-content: center; /* Horizontally center the flex items (the text) */
        width: 0%; /* Initial width */
        background-color: #007bff; /* Background color of the progress bar */
        transition: width 0.6s ease; /* Smooth transition for the width */
        color: #fff; /* Text color */
        font-weight: bold; /* Optional: make the text bold */
        border-radius: 5px; /* Match the parent's border-radius */
      }

      #loading-text {
        margin-top: 20px;
        margin-bottom: 20px;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      @media (max-width: 991px) {
        .navbar-nav {
          text-align: center; /* Center navigation links on smaller screens */
        }
        .footer {
          font-size: 0.8em; /* Further reduce font size for very small screens */
        }
        .content-wrap {
          height: auto; /* Allow content wrap to grow as needed */
          min-height: calc(
            100vh - 100px
          ); /* Ensure it takes at least the viewport height minus footer */
          padding-bottom: 60px; /* Give some space for the footer */
        }
      }
      /* Close the previous media query block before starting a new one */
      @media (min-width: 992px) {
        .progress {
          width: 60vw; /* You can adjust the width as needed */
          /* max-width: none; You can remove this if you set a specific width */
        }
      }
    </style>

    <link rel="icon" href="/images/favicon.ico" type="image/x-icon" />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="index.html">
        <img
          src="/images/logo.png"
          alt="Historic Graves Logo"
          style="height: 50px; width: auto; margin-right: 10px"
        />
        Historic Graves Text Harvester
      </a>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="results.html">View Previous Results</a>
          </li>
        </ul>
      </div>
    </nav>

    <div class="content-wrap">
      <div>
        <div class="processing-message">
          <h2>Processing...</h2>
          <p>Please wait, currently processing your file(s).</p>
          <div class="loading"></div>
          <div id="loading-text">Processing...</div>
        </div>
        <div class="progress-container">
          <div class="progress">
            <div
              id="progressBar"
              class="progress-bar"
              role="progressbar"
              aria-valuenow="0"
              aria-valuemin="0"
              aria-valuemax="100"
            >
              <span>0% Complete</span>
              <!-- Text centered inside the progress bar -->
            </div>
          </div>
        </div>
      </div>
    </div>
    <footer class="footer">
      Â© 2024 Historic Graves Project. All rights reserved. For more info,
      contact me at
      <a href="mailto:me@danieltierney.ie">me@danieltierney.ie</a> or visit the
      <a href="https://www.historicgraves.ie" target="_blank"
        >Historic Graves</a
      >
      website.
    </footer>
    <script>
      function updateProgressBar(percentage) {
        const progressBar = document.getElementById("progressBar");
        progressBar.style.width = percentage + "%";
        progressBar.textContent = `${percentage}% Complete`;
      }
      function checkProcessingStatus() {
        fetch("/processing-status")
          .then((response) => response.json())
          .then((data) => {
            updateProgressBar(data.progress);
            if (data.status === "complete") {
              setTimeout(() => {
                window.location.href = "/results.html";
              }, 1000);
            }
          })
          .catch((error) => {
            console.error("Error fetching processing status:", error);
          });
      }
      checkProcessingStatus();
      setInterval(checkProcessingStatus, 2000);
      setTimeout(() => {
        window.location.href = "/results.html";
      }, 24000000);
    </script>
    <script>
      $(document).ready(function () {
        $('[data-toggle="tooltip"]').tooltip();
      });
    </script>
  </body>
</html>
