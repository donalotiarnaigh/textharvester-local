<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Historic Graves Text Harvester</title>

    <!-- Include Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />

    <!-- Include Dropzone.js -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/dropzone.min.css"
    />

    <!-- Include jQuery and Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/dropzone.min.js"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/styles.css" />
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon" />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="index.html">
        <img
          src="/images/logo.png"
          alt="Historic Graves Logo"
          style="height: 50px; margin-right: 10px"
        />
        Historic Graves Text Harvester
      </a>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="results.html">View Previous Results</a>
          </li>
        </ul>
      </div>
    </nav>

    <div class="content-wrap">
      <div class="container">
        <!-- Instructions Box -->
        <div class="card instructions">
          <div class="card-body">
            <h5 class="card-title">How to Use the Text Harvester</h5>
            <p class="card-text">
              To upload files, drag and drop your JPEG images or PDF documents
              into the drop zone or click to select files. Once uploaded, your
              files will be processed for text extraction. You can track
              progress on the processing page. When processing is complete,
              you'll be redirected to the results page.
            </p>
            <small>
              Supported file types: .jpeg, .jpg, .pdf. Maximum file size: 100MB
              per file.
            </small>
            <small>
              Note: Each page of uploaded PDFs will be processed as a separate
              image.
            </small>
            <small>
              Ensure PDFs are not encrypted as encryption will prevent
              successful processing.
            </small>
          </div>
        </div>

        <!-- Drop Zone for File Upload -->
        <form action="/upload" class="dropzone" id="uploadForm">
          <div class="dz-message">
            Drop files here or click to upload (JPEG or PDF).
          </div>
        </form>

        <!-- Submit Button -->
        <button id="submitFiles" class="btn btn-success btn-block">
          Submit Files
        </button>
      </div>
    </div>

    <footer class="footer">
      Â© 2024 Historic Graves Project. For more info, contact
      <a href="mailto:daniel@textharvester.ie">daniel@textharvester.ie</a> or
      <a href="https://www.historicgraves.ie" target="_blank"
        >Historic Graves</a
      >
      website.
    </footer>

    <script>
      Dropzone.options.uploadForm = {
        acceptedFiles: ".jpg, .jpeg, .pdf",
        maxFiles: 1000,
        autoProcessQueue: false, // Manual processing
        parallelUploads: 1000, // Handle large uploads
        dictInvalidFileType: "Only .jpeg, .jpg, and .pdf files are allowed.",
        dictMaxFilesExceeded: "Maximum of 1,000 files allowed.",

        init: function () {
          var dropzoneInstance = this;

          console.log("Dropzone initialized"); // Log initialization

          // Handle manual file submission
          document.getElementById("submitFiles").onclick = function () {
            console.log("Manual file submission triggered."); // Log when submission is triggered
            dropzoneInstance.processQueue(); // Manually trigger file submission
          };

          // Queue monitoring and completion logging
          dropzoneInstance.on("addedfile", function (file) {
            console.log("File added:", file.name); // Log when a file is added to the queue
          });

          dropzoneInstance.on("complete", function (file) {
            console.log("File upload complete:", file.name); // Log when a file upload is complete
          });

          dropzoneInstance.on("queuecomplete", function () {
            console.log(
              "All files have been uploaded. Redirecting to processing.html."
            );
            window.location.href = "/processing.html"; // Redirect when all files are uploaded
          });

          // Error handling with detailed logging
          dropzoneInstance.on("error", function (file, errorMessage) {
            console.error(
              "Error during file upload:",
              file.name,
              "Error:",
              errorMessage
            );
          });
        },
      };
    </script>
  </body>
</html>
