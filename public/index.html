<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Historic Graves Text Harvester</title>

    <!-- Include Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />

    <!-- Include Dropzone.js -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/dropzone.min.css"
    />

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/dropzone.min.js"></script>

    <!-- Custom CSS -->
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
      }
      .content-wrap {
        min-height: calc(100vh - 70px);
        padding-bottom: 20px;
      }
      .footer {
        background-color: #f8f9fa;
        color: black;
        text-align: center;
        padding: 30px 0;
        font-size: 0.9em;
        position: relative;
        height: auto;
        clear: both;
      }
      .dropzone {
        border: 2px dashed #007bff;
        padding: 20px;
        text-align: center;
        background-color: #f8f9fa;
      }
      .dropzone.active {
        border-color: #0056b3;
        background-color: #e9ecef;
      }
    </style>
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon" />
  </head>

  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="index.html">
        <img
          src="/images/logo.png"
          alt="Historic Graves Logo"
          style="height: 50px; width: auto; margin-right: 10px"
        />
        Historic Graves Text Harvester
      </a>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="results.html">View Previous Results</a>
          </li>
        </ul>
      </div>
    </nav>

    <div class="content-wrap">
      <div class="container">
        <!-- Instructions Box -->
        <div class="row">
          <div class="col-12 col-md-8 offset-md-2">
            <div class="card instructions">
              <div class="card-body">
                <h5 class="card-title">How to Use the Text Harvester</h5>
                <p class="card-text">
                  To upload files, drag and drop your JPEG images into the drop
                  zone below, or click to select files from your device. Once
                  uploaded, your files will be processed for text extraction.
                  You can track the progress on the processing page. When
                  processing is complete, you'll be redirected to the results
                  page to view and download the extracted data.
                </p>
                <small>
                  Supported file types: .jpeg, .jpg. Maximum 1,000 files can be
                  uploaded at once.
                </small>
              </div>
            </div>
          </div>
        </div>

        <!-- Drop Zone for File Upload -->
        <form action="/upload" class="dropzone" id="uploadForm">
          <div class="dz-message">Drop files here or click to upload.</div>
        </form>
      </div>
      <!-- Submit Button -->
      <button id="submitFiles" class="btn btn-success btn-block">
        Submit Files
      </button>
    </div>

    <footer class="footer">
      Â© 2024 Historic Graves Project. All rights reserved. For more info,
      contact me at
      <a href="mailto:me@danieltierney.ie">me@danieltierney.ie</a> or visit the
      <a href="https://www.historicgraves.ie" target="_blank"
        >Historic Graves</a
      >
      website.
    </footer>

    <!-- Dropzone Configuration -->
    <script>
      Dropzone.options.uploadForm = {
        acceptedFiles: ".jpg, .jpeg",
        maxFiles: 1000,
        autoProcessQueue: false, // Manual processing
        parallelUploads: 1000, // Allow submitting all files at once
        // uploadMultiple: true, // Submit multiple files in one request
        dictInvalidFileType: "Only .jpeg and .jpg files are allowed.",
        dictMaxFilesExceeded: "Maximum of 1,000 files allowed.",

        init: function () {
          var dropzoneInstance = this;

          console.log("Dropzone initialized");

          // Handle manual file submission
          document.getElementById("submitFiles").onclick = function () {
            console.log("Manual file submission triggered.");
            dropzoneInstance.processQueue(); // Submit all files at once
            window.location.href = "/processing.html"; // Redirect on completion
          };

          // Optional: Error handling and queue monitoring
          dropzoneInstance.on("error", function (file, errorMessage) {
            console.error(
              "Error during file upload:",
              file.name,
              "Error:",
              errorMessage
            );
          });
        },
      };
    </script>
  </body>
</html>
