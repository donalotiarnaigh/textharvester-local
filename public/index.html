<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Historic Graves Text Harvester</title>

    <!-- Include Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />

    <!-- Include Dropzone.js -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/dropzone.min.css"
    />

    <!-- Include jQuery and Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/dropzone.min.js"></script>

    <!-- Custom CSS -->
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon" />
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
      }
      .content-wrap {
        display: flex;
        flex-direction: column; /* Ensures elements are stacked vertically */
        justify-content: flex-start; /* Aligns content at the top */
        align-items: center; /* Centers content horizontally */
        min-height: calc(
          100vh - 70px
        ); /* Adjust to allow content to be higher up */
        padding-top: 20px; /* Optional padding to position content higher */
        padding-bottom: 20px; /* Ensures enough space for the footer */
      }
      .footer {
        background-color: #f8f9fa;
        text-align: center;
        padding: 30px 0;
        font-size: 0.9em;
        clear: both;
        position: sticky; /* Makes the footer stick to the bottom of the viewport */
        bottom: 0; /* Ensures it stays at the bottom */
        width: 100%; /* Ensures the footer takes the full width of the container */
        z-index: 10; /* Keeps it above other elements if necessary */
      }
      .dropzone {
        border: 2px dashed #007bff;
        padding: 20px;
        text-align: center;
        background-color: #f8f9fa;
        display: flex; /* Enables centering with flexbox */
        justify-content: center; /* Centers content horizontally */
        align-items: center;
        flex-wrap: wrap; /* Centers content vertically */
        min-height: 200px; /* Ensures the drop zone has a minimum height */
        margin: auto; /* Centers the drop zone within its container */
      }
      .dropzone.active {
        border-color: #0056b3;
        background-color: #e9ecef;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="index.html">
        <img
          src="/images/logo.png"
          alt="Historic Graves Logo"
          style="height: 50px; margin-right: 10px"
        />
        Historic Graves Text Harvester
      </a>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="results.html">View Previous Results</a>
          </li>
        </ul>
      </div>
    </nav>

    <div class="content-wrap">
      <div class="container">
        <!-- Instructions Box -->
        <div class="card instructions">
          <div class="card-body">
            <h5 class="card-title">How to Use the Text Harvester</h5>
            <p class="card-text">
              To upload files, drag and drop your JPEG images into the drop zone
              or click to select files. Once uploaded, your files will be
              processed for text extraction. You can track progress on the
              processing page. When processing is complete, you'll be redirected
              to the results page.
            </p>
            <small>
              Supported file types: .jpeg, .jpg. Maximum 1,000 files can be
              uploaded at once.
            </small>
          </div>
        </div>

        <!-- Drop Zone for File Upload -->
        <form action="/upload" class="dropzone" id="uploadForm">
          <div class="dz-message">Drop files here or click to upload.</div>
        </form>

        <!-- Submit Button -->
        <button id="submitFiles" class="btn btn-success btn-block">
          Submit Files
        </button>
      </div>
    </div>

    <footer class="footer">
      Â© 2024 Historic Graves Project. For more info, contact
      <a href="mailto:daniel@textharvester.ie">daniel@textharvester.ie</a> or
      <a href="https://www.historicgraves.ie" target="_blank"
        >Historic Graves</a
      >
      website.
    </footer>

    <script>
      Dropzone.options.uploadForm = {
        acceptedFiles: ".jpg, .jpeg",
        maxFiles: 1000,
        autoProcessQueue: false, // Manual processing
        parallelUploads: 1000, // Handle large uploads
        dictInvalidFileType: "Only .jpeg and .jpg files are allowed.",
        dictMaxFilesExceeded: "Maximum of 1,000 files allowed.",

        init: function () {
          var dropzoneInstance = this;

          console.log("Dropzone initialized"); // Log initialization

          // Handle manual file submission
          document.getElementById("submitFiles").onclick = function () {
            console.log("Manual file submission triggered."); // Log when submission is triggered
            dropzoneInstance.processQueue(); // Manually trigger file submission
          };

          // Queue monitoring and completion logging
          dropzoneInstance.on("addedfile", function (file) {
            console.log("File added:", file.name); // Log when a file is added to the queue
          });

          dropzoneInstance.on("complete", function (file) {
            console.log("File upload complete:", file.name); // Log when a file upload is complete
          });

          // Handle manual file submission
          document.getElementById("submitFiles").onclick = function () {
            console.log("Manual file submission triggered."); // Log when submission is triggered
            dropzoneInstance.processQueue(); // Start processing the files

            // Delay redirection by 2 seconds
            setTimeout(function () {
              console.log(
                "Redirecting to processing.html after 2-second delay."
              );
              window.location.href = "/processing.html"; // Redirect after a 2-second delay
            }, 1500); // 2000 milliseconds = 2 seconds
          };

          // Error handling with detailed logging
          dropzoneInstance.on("error", function (file, errorMessage) {
            console.error(
              "Error during file upload:",
              file.name,
              "Error:",
              errorMessage
            );
          });
        },
      };
    </script>
  </body>
</html>
